<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>piano999</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    margin-top: 30vh;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #000000;
  }
  

  /* ====== เปียโนหลัก 2 โอคเทฟ ====== */
  .piano {
    position: relative;
    height: 240px;
    width: 1120px; /* 14 white keys * 80px */
    margin-bottom: 40px;
    display: flex;
    user-select: none;
  }
  .key.white {
    width: 80px;
    height: 240px;
    background: white;
    border: 1px solid black;
    box-sizing: border-box;
    border-radius: 0px 0px 8px 8px;
    box-shadow: inset 0 -5px 5px -5px rgba(0,0,0,0.3);
    cursor: pointer;
    text-align: center;
    line-height: 230px;
    font-weight: bold;
    position: relative;
    z-index: 1;
    transition: background-color 0.3s;
    flex-shrink: 0;
  }
  .key.white:active {
    background: #ddd;
  }

  .key.black {
    width: 50px;
    height: 140px;
    background: black;
    position: absolute;
    top: 0;
    border-radius: 0 0 6px 6px;
    border: 1px solid #333;
    box-shadow: 0 4px 6px rgba(0,0,0,0.5);
    cursor: pointer;
    color: white;
    font-weight: bold;
    text-align: center;
    line-height: 130px;
    user-select: none;
    z-index: 2;
    transition: background-color 0.3s;
  }
  .key.black:active {
    background: #555;
  }

  /* ตำแหน่งปุ่มดำสำหรับ 2 โอคเทฟ */
  /* octave 4 */
  .key.black.cSharp4 { left: 60px; }
  .key.black.dSharp4 { left: 140px; }
  .key.black.fSharp4 { left: 300px; }
  .key.black.gSharp4 { left: 380px; }
  .key.black.aSharp4 { left: 460px; }
  /* octave 5 */
  .key.black.cSharp5 { left: 620px; }
  .key.black.dSharp5 { left: 700px; }
  .key.black.fSharp5 { left: 860px; }
  .key.black.gSharp5 { left: 940px; }
  .key.black.aSharp5 { left: 1020px; }

  /* ไฮไลต์เปียโนหลัก */
  .piano .key.highlight-white {
    background-color: #a3c4f3 !important;
  }
  .piano .key.highlight-black {
    background-color: #3b7ddd !important;
  }

  /* ====== รายการคอร์ด ====== */
  #chord-list {
    max-width: 900px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
  .chord {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
    padding: 20px 14px;
    cursor: pointer;
    user-select: none;
    width: 280px;
    font-weight: bold;
    text-align: center;
    position: relative;
    transition: box-shadow 0.3s;
  }
  .chord:hover {
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.25);
  }
  .chord.selected {
    box-shadow: 0 0 14px 4px #3b7ddd;
  }

  /* ====== mini piano ในแต่ละคอร์ด ====== */
  .mini-piano {
    position: relative;
    margin-top: 10px;
    height: 80px;
    width: 280px;
    user-select: none;
  }
  .mini-piano .key.white {
    width: 40px;
    height: 80px;
    background: white;
    border: 1px solid #999;
    box-sizing: border-box;
    border-radius: 0 0 5px 5px;
    box-shadow: inset 0 -3px 3px -3px rgba(0,0,0,0.2);
    cursor: pointer;
    text-align: center;
    line-height: 75px;
    font-weight: bold;
    position: relative;
    z-index: 1;
    float: left;
  }
  .mini-piano .key.black {
    width: 20px;
    height: 50px;
    background: black;
    position: absolute;
    top: 0;
    border-radius: 4px 4px 4px 4px;
    border: 1px solid #222;
    box-shadow: 0 3px 5px rgba(0,0,0,0.6);
    cursor: pointer;
    color: white;
    font-weight: bold;
    text-align: center;
    line-height: 45px;
    user-select: none;
    z-index: 2;
  }
  .mini-piano .key.black.cSharp { left: 25px; }
  .mini-piano .key.black.dSharp { left: 65px; }
  .mini-piano .key.black.fSharp { left: 145px; }
  .mini-piano .key.black.gSharp { left: 185px; }
  .mini-piano .key.black.aSharp { left: 225px; }

  /* โน้ตใน mini piano ที่เป็นคอร์ดถูกกด */
  .mini-piano .key.pressed.white {
    background-color: #a3c4f3 !important;
  }
  .mini-piano .key.pressed.black {
    background-color: #4a4c50 !important;
  }
</style>
</head>
<body>

<div class="piano" id="piano">
  <!-- ปุ่มขาว 14 คีย์ (C4-B5) -->
  <div class="key white" data-note="C4">C</div>
  <div class="key white" data-note="D4">D</div>
  <div class="key white" data-note="E4">E</div>
  <div class="key white" data-note="F4">F</div>
  <div class="key white" data-note="G4">G</div>
  <div class="key white" data-note="A4">A</div>
  <div class="key white" data-note="B4">B</div>

  <div class="key white" data-note="C5">C</div>
  <div class="key white" data-note="D5">D</div>
  <div class="key white" data-note="E5">E</div>
  <div class="key white" data-note="F5">F</div>
  <div class="key white" data-note="G5">G</div>
  <div class="key white" data-note="A5">A</div>
  <div class="key white" data-note="B5">B</div>

  <!-- ปุ่มดำ octave 4 -->
  <div class="key black cSharp4" data-note="C#4">C#</div>
  <div class="key black dSharp4" data-note="D#4">D#</div>
  <div class="key black fSharp4" data-note="F#4">F#</div>
  <div class="key black gSharp4" data-note="G#4">G#</div>
  <div class="key black aSharp4" data-note="A#4">A#</div>
  <!-- ปุ่มดำ octave 5 -->
  <div class="key black cSharp5" data-note="C#5">C#</div>
  <div class="key black dSharp5" data-note="D#5">D#</div>
  <div class="key black fSharp5" data-note="F#5">F#</div>
  <div class="key black gSharp5" data-note="G#5">G#</div>
  <div class="key black aSharp5" data-note="A#5">A#</div>
</div>

<div id="chord-list"></div>

<script>
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const noteFreqMap = {
    'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63,
    'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00,
    'A#4': 466.16, 'B4': 493.88,
    'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 'E5': 659.25,
    'F5': 698.46, 'F#5': 739.99, 'G5': 783.99, 'G#5': 830.61, 'A5': 880.00,
    'A#5': 932.33, 'B5': 987.77
  };

  function playFreq(freq) {
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = freq;
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    osc.start();
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.8);
    osc.stop(audioCtx.currentTime + 0.8);
  }

  function playNote(note) {
    const freq = noteFreqMap[note];
    if (freq) playFreq(freq);
  }

  const chromaticScale = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

  // สร้างโน้ตคอร์ดตาม root + type
  function buildChord(root, type) {
    // แปลง root (C, D, E...) เป็น index chromaticScale
    let rootIdx = chromaticScale.indexOf(root);
    if (rootIdx === -1) return [];

    // helper: แปลง note + octave เป็น note string เช่น C4
    function noteAt(idx, octave) {
      idx = idx % 12;
      return chromaticScale[idx] + octave;
    }

    let octave = 4; // ใช้ octave 4 เป็นหลัก (เสียงหลักเปียโน)
    let notes = [];

    switch(type) {
      case 'major':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 4, octave),
          noteAt(rootIdx + 7, octave)
        ];
        break;
      case 'minor':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 3, octave),
          noteAt(rootIdx + 7, octave)
        ];
        break;
      case '7th':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 4, octave),
          noteAt(rootIdx + 7, octave),
          noteAt(rootIdx + 10, octave)
        ];
        break;
      case 'maj7':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 4, octave),
          noteAt(rootIdx + 7, octave),
          noteAt(rootIdx + 11, octave)
        ];
        break;
      case 'dim':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 3, octave),
          noteAt(rootIdx + 6, octave)
        ];
        break;
      case 'aug':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 4, octave),
          noteAt(rootIdx + 8, octave)
        ];
        break;
      case 'sus2':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 2, octave),
          noteAt(rootIdx + 7, octave)
        ];
        break;
      case 'sus4':
        notes = [
          noteAt(rootIdx, octave),
          noteAt(rootIdx + 5, octave),
          noteAt(rootIdx + 7, octave)
        ];
        break;
      default:
        notes = [noteAt(rootIdx, octave)];
    }

    return notes;
  }

  // เล่นคอร์ดพร้อมกัน
  function playChord(notes) {
    notes.forEach(note => playNote(note));
  }

  // ตัวแปรเก็บปุ่มเปียโนหลัก
  const piano = document.getElementById('piano');
  const pianoKeys = {};
  piano.querySelectorAll('.key').forEach(key => {
    pianoKeys[key.dataset.note] = key;
    key.addEventListener('click', () => {
      playNote(key.dataset.note);
      highlightNoteOnPiano(key.dataset.note);
    });
  });

  // ไฮไลต์ปุ่มบนเปียโนหลัก
  function highlightNoteOnPiano(note) {
    // ล้าง highlight ก่อน
    Object.values(pianoKeys).forEach(k => {
      k.classList.remove('highlight-white', 'highlight-black');
    });
    const key = pianoKeys[note];
    if (!key) return;
    if (key.classList.contains('white')) {
      key.classList.add('highlight-white');
    } else {
      key.classList.add('highlight-black');
    }
  }

  // --- คอร์ดที่มีให้เลือก (เยอะขึ้น) ---
  const chords = [
    { root: 'C', type: 'major' },
    { root: 'C', type: 'minor' },
    { root: 'C', type: '7th' },
    { root: 'C', type: 'maj7' },
    { root: 'C', type: 'dim' },
    { root: 'C', type: 'aug' },
    { root: 'C', type: 'sus2' },
    { root: 'C', type: 'sus4' },

    { root: 'D', type: 'major' },
    { root: 'D', type: 'minor' },
    { root: 'D', type: '7th' },
    { root: 'D', type: 'maj7' },
    { root: 'D', type: 'dim' },
    { root: 'D', type: 'aug' },
    { root: 'D', type: 'sus2' },
    { root: 'D', type: 'sus4' },

    { root: 'E', type: 'major' },
    { root: 'E', type: 'minor' },
    { root: 'E', type: '7th' },
    { root: 'E', type: 'maj7' },
    { root: 'E', type: 'dim' },
    { root: 'E', type: 'aug' },
    { root: 'E', type: 'sus2' },
    { root: 'E', type: 'sus4' },

    { root: 'F', type: 'major' },
    { root: 'F', type: 'minor' },
    { root: 'F', type: '7th' },
    { root: 'F', type: 'maj7' },
    { root: 'F', type: 'dim' },
    { root: 'F', type: 'aug' },
    { root: 'F', type: 'sus2' },
    { root: 'F', type: 'sus4' },

    { root: 'G', type: 'major' },
    { root: 'G', type: 'minor' },
    { root: 'G', type: '7th' },
    { root: 'G', type: 'maj7' },
    { root: 'G', type: 'dim' },
    { root: 'G', type: 'aug' },
    { root: 'G', type: 'sus2' },
    { root: 'G', type: 'sus4' },

    { root: 'A', type: 'major' },
    { root: 'A', type: 'minor' },
    { root: 'A', type: '7th' },
    { root: 'A', type: 'maj7' },
    { root: 'A', type: 'dim' },
    { root: 'A', type: 'aug' },
    { root: 'A', type: 'sus2' },
    { root: 'A', type: 'sus4' },

    { root: 'B', type: 'major' },
    { root: 'B', type: 'minor' },
    { root: 'B', type: '7th' },
    { root: 'B', type: 'maj7' },
    { root: 'B', type: 'dim' },
    { root: 'B', type: 'aug' },
    { root: 'B', type: 'sus2' },
    { root: 'B', type: 'sus4' },
  ];

  const chordListDiv = document.getElementById('chord-list');
  let selectedChordIndex = -1;

  function createMiniPiano(notes, container) {
    // สร้าง mini piano 7 โน้ต + 5 ปุ่มดำ octave 5 เล็กลง
    const piano = document.createElement('div');
    piano.className = 'mini-piano';

    // white keys 7 ตัว (C D E F G A B) octave 5
    const whiteOrder = ['C5','D5','E5','F5','G5','A5','B5'];
    whiteOrder.forEach(note => {
      const k = document.createElement('div');
      k.className = 'key white';
      k.textContent = note[0];
      k.dataset.note = note;
      piano.appendChild(k);
    });

    // black keys
    const blackNotes = [
      {note:'C#5', cls:'cSharp'},
      {note:'D#5', cls:'dSharp'},
      {note:'F#5', cls:'fSharp'},
      {note:'G#5', cls:'gSharp'},
      {note:'A#5', cls:'aSharp'}
    ];
    blackNotes.forEach(({note,cls}) => {
      const k = document.createElement('div');
      k.className = 'key black ' + cls;
      k.textContent = note[0] + '#';
      k.dataset.note = note;
      piano.appendChild(k);
    });

    // ไฮไลต์โน้ตในคอร์ด
    piano.querySelectorAll('.key').forEach(key => {
      if (notes.includes(key.dataset.note)) {
        key.classList.add('pressed');
      }
    });

    return piano;
  }

  function renderChordList() {
    chordListDiv.innerHTML = '';
    chords.forEach((chord, idx) => {
      const chordDiv = document.createElement('div');
      chordDiv.className = 'chord';
      chordDiv.textContent = `${chord.root} ${chord.type}`;
      chordDiv.dataset.index = idx;

      // สร้าง mini piano ของคอร์ด
      const chordNotes = buildChord(chord.root, chord.type);
      const miniPiano = createMiniPiano(chordNotes, chordDiv);
      chordDiv.appendChild(miniPiano);

      // เลือกคอร์ด
      chordDiv.addEventListener('click', () => {
        selectChord(idx);
      });

      chordListDiv.appendChild(chordDiv);
    });
  }

  function selectChord(idx) {
    if (selectedChordIndex === idx) return; // เลือกซ้ำไม่ทำอะไร

    selectedChordIndex = idx;

    // ไฮไลต์คอร์ดที่เลือก
    chordListDiv.querySelectorAll('.chord').forEach((el, i) => {
      el.classList.toggle('selected', i === idx);
    });

    // เล่นเสียงคอร์ด
    const chord = chords[idx];
    const notes = buildChord(chord.root, chord.type);
    playChord(notes);

    // ไฮไลต์โน้ตบนเปียโนหลักตามคอร์ดนี้
    highlightChordOnPiano(notes);
  }

  // ไฮไลต์โน้ตบนเปียโนหลักตามคอร์ด
  function highlightChordOnPiano(notes) {
    // ล้าง highlight ก่อน
    Object.values(pianoKeys).forEach(k => {
      k.classList.remove('highlight-white', 'highlight-black');
    });

    notes.forEach(note => {
      // แปลงโน้ต octave 5 -> 4 เพื่อให้ตรงกับเปียโนหลัก 2 โอคเทฟ
      let note4or5 = note;
      // ใน mini piano ใช้ octave5 เสมอ แต่เปียโนหลักมี octave4 กับ 5
      // พยายามหา key บนเปียโนหลักก่อน ถ้าไม่มีลอง octave 5
      if (!pianoKeys[note4or5]) {
        const altNote = note[0] + (note.endsWith('5') ? '4' : '5');
        if (pianoKeys[altNote]) note4or5 = altNote;
      }
      const key = pianoKeys[note4or5];
      if (!key) return;
      if (key.classList.contains('white')) {
        key.classList.add('highlight-white');
      } else {
        key.classList.add('highlight-black');
      }
    });
  }

  renderChordList();

</script>

</body>
</html>
